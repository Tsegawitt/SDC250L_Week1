--Tsegawit Gebremedhin
-- Question 1: Eliminate STOREFRONT


-- Add PRICE column
ALTER TABLE PRODUCTLIST
ADD PRICE NUMBER(6,2);

-- Add DESCRIPTION column
ALTER TABLE PRODUCTLIST
ADD DESCRIPTION VARCHAR2(250);

-- Move data from STOREFRONT to PRODUCTLIST
UPDATE PRODUCTLIST P
SET (PRICE, DESCRIPTION) =
(
    SELECT S.PRICE, S.DESCRIPTION
    FROM STOREFRONT S
    WHERE S.PRODUCTCODE = P.PRODUCTCODE
);

-- Drop STOREFRONT table
DROP TABLE STOREFRONT;



-- Question 2: CHATLOG


CREATE TABLE CHATLOG (
    CHATID NUMBER(3) PRIMARY KEY,
    RECEIVERID NUMBER(3),
    SENDERID NUMBER(3),
    DATESENT DATE,
    CONTENT VARCHAR2(250),
    CONSTRAINT fk_chat_receiver FOREIGN KEY (RECEIVERID)
        REFERENCES USERBASE(USERID),
    CONSTRAINT fk_chat_sender FOREIGN KEY (SENDERID)
        REFERENCES USERBASE(USERID)
);

INSERT INTO CHATLOG VALUES (1, 101, 102, SYSDATE, 'Hey!');
INSERT INTO CHATLOG VALUES (2, 102, 101, SYSDATE, 'Hello!');
INSERT INTO CHATLOG VALUES (3, 103, 101, SYSDATE, 'Ready to game?');
INSERT INTO CHATLOG VALUES (4, 101, 103, SYSDATE, 'Yes!');
INSERT INTO CHATLOG VALUES (5, 104, 105, SYSDATE, 'GG!');
INSERT INTO CHATLOG VALUES (6, 105, 104, SYSDATE, 'Nice match');
INSERT INTO CHATLOG VALUES (7, 106, 101, SYSDATE, 'Invite sent');
INSERT INTO CHATLOG VALUES (8, 101, 106, SYSDATE, 'Got it');
INSERT INTO CHATLOG VALUES (9, 107, 108, SYSDATE, 'See you later');
INSERT INTO CHATLOG VALUES (10, 108, 107, SYSDATE, 'Bye');



-- Question 3: FRIENDSLIST


CREATE TABLE FRIENDSLIST (
    USERID NUMBER(3),
    FRIENDID NUMBER(3),
    CONSTRAINT pk_friends PRIMARY KEY (USERID, FRIENDID),
    CONSTRAINT fk_friend_user FOREIGN KEY (USERID)
        REFERENCES USERBASE(USERID),
    CONSTRAINT fk_friend_friend FOREIGN KEY (FRIENDID)
        REFERENCES USERBASE(USERID)
);

INSERT INTO FRIENDSLIST VALUES (101,102);
INSERT INTO FRIENDSLIST VALUES (101,103);
INSERT INTO FRIENDSLIST VALUES (102,103);
INSERT INTO FRIENDSLIST VALUES (104,105);
INSERT INTO FRIENDSLIST VALUES (106,101);
INSERT INTO FRIENDSLIST VALUES (107,108);
INSERT INTO FRIENDSLIST VALUES (109,110);
INSERT INTO FRIENDSLIST VALUES (103,104);
INSERT INTO FRIENDSLIST VALUES (105,106);
INSERT INTO FRIENDSLIST VALUES (108,109);



-- Question 4: WISHLIST


CREATE TABLE WISHLIST (
    USERID NUMBER(3),
    PRODUCTCODE VARCHAR2(5),
    POSITION NUMBER(3),
    CONSTRAINT pk_wishlist PRIMARY KEY (USERID, PRODUCTCODE),
    CONSTRAINT fk_wishlist_user FOREIGN KEY (USERID)
        REFERENCES USERBASE(USERID),
    CONSTRAINT fk_wishlist_product FOREIGN KEY (PRODUCTCODE)
        REFERENCES PRODUCTLIST(PRODUCTCODE)
);

INSERT INTO WISHLIST VALUES (101, 'GAME1', 1);
INSERT INTO WISHLIST VALUES (101, 'GAME2', 2);
INSERT INTO WISHLIST VALUES (102, 'GAME3', 1);
INSERT INTO WISHLIST VALUES (102, 'GAME4', 2);
INSERT INTO WISHLIST VALUES (103, 'GAME5', 1);
INSERT INTO WISHLIST VALUES (104, 'GAME6', 1);
INSERT INTO WISHLIST VALUES (105, 'GAME7', 1);
INSERT INTO WISHLIST VALUES (106, 'GAME8', 1);
INSERT INTO WISHLIST VALUES (107, 'GAME9', 1);
INSERT INTO WISHLIST VALUES (108, 'GME12', 1);



-- Question 5: USERPROFILE


CREATE TABLE USERPROFILE (
    USERID NUMBER(3) PRIMARY KEY,
    IMAGEFILE VARCHAR2(250),
    DESCRIPTION VARCHAR2(250),
    CONSTRAINT fk_profile_user FOREIGN KEY (USERID)
        REFERENCES USERBASE(USERID)
);

INSERT INTO USERPROFILE VALUES (101, 'img101.jpg', 'Loves RPG games');
INSERT INTO USERPROFILE VALUES (102, 'img102.jpg', 'Competitive FPS player');
INSERT INTO USERPROFILE VALUES (103, 'img103.jpg', 'Strategy mastermind');
INSERT INTO USERPROFILE VALUES (104, 'img104.jpg', 'Casual gamer');
INSERT INTO USERPROFILE VALUES (105, 'img105.jpg', 'Horror game fan');
INSERT INTO USERPROFILE VALUES (106, 'img106.jpg', 'MMO addict');
INSERT INTO USERPROFILE VALUES (107, 'img107.jpg', 'Sports game player');
INSERT INTO USERPROFILE VALUES (108, 'img108.jpg', 'Adventure explorer');
INSERT INTO USERPROFILE VALUES (109, 'img109.jpg', 'Indie supporter');
INSERT INTO USERPROFILE VALUES (110, 'img110.jpg', 'Puzzle solver');



-- Question 6: SECURITYQUESTION


CREATE TABLE SECURITYQUESTION (
    QUESTIONID NUMBER PRIMARY KEY,
    USERID NUMBER(3),
    QUESTION VARCHAR2(250),
    ANSWER VARCHAR2(250),
    CONSTRAINT fk_sec_user FOREIGN KEY (USERID)
        REFERENCES USERBASE(USERID)
);

INSERT INTO SECURITYQUESTION VALUES (1, 101, 'First pet name?', 'Buddy');
INSERT INTO SECURITYQUESTION VALUES (2, 102, 'Birth city?', 'Dallas');
INSERT INTO SECURITYQUESTION VALUES (3, 103, 'Favorite food?', 'Pizza');
INSERT INTO SECURITYQUESTION VALUES (4, 104, 'First school?', 'Lincoln');
INSERT INTO SECURITYQUESTION VALUES (5, 105, 'Mothers maiden name?', 'Smith');
INSERT INTO SECURITYQUESTION VALUES (6, 106, 'Dream job?', 'Developer');
INSERT INTO SECURITYQUESTION VALUES (7, 107, 'Childhood nickname?', 'Ace');
INSERT INTO SECURITYQUESTION VALUES (8, 108, 'Favorite movie?', 'Inception');
INSERT INTO SECURITYQUESTION VALUES (9, 109, 'Street you grew up on?', 'Maple');
INSERT INTO SECURITYQUESTION VALUES (10, 110, 'Favorite game?', 'Zelda');



-- Question 7: COMMUNITYRULES


CREATE TABLE COMMUNITYRULES (
    RULENUM NUMBER(3) PRIMARY KEY,
    TITLE VARCHAR2(250),
    DESCRIPTION VARCHAR2(250),
    SEVERITYPOINT NUMBER(4)
);

INSERT INTO COMMUNITYRULES VALUES (1, 'No Harassment', 'Do not harass users.', 100);
INSERT INTO COMMUNITYRULES VALUES (2, 'No Hate Speech', 'Hate speech prohibited.', 150);
INSERT INTO COMMUNITYRULES VALUES (3, 'No Spamming', 'No spam allowed.', 75);
INSERT INTO COMMUNITYRULES VALUES (4, 'No Cheating', 'Cheating forbidden.', 120);
INSERT INTO COMMUNITYRULES VALUES (5, 'Respect Privacy', 'Do not share private info.', 110);
INSERT INTO COMMUNITYRULES VALUES (6, 'No Exploits', 'No system exploits.', 130);
INSERT INTO COMMUNITYRULES VALUES (7, 'Appropriate Content', 'No explicit content.', 90);
INSERT INTO COMMUNITYRULES VALUES (8, 'No Impersonation', 'No impersonation.', 95);
INSERT INTO COMMUNITYRULES VALUES (9, 'Follow Moderators', 'Obey moderators.', 80);
INSERT INTO COMMUNITYRULES VALUES (10, 'Fair Play', 'Play fairly.', 70);



-- Question 8: INFRACTIONS


CREATE TABLE INFRACTIONS (
    INFRACTIONID NUMBER PRIMARY KEY,
    USERID NUMBER(3),
    RULENUM NUMBER(3),
    DATEASSIGNED DATE,
    PENALTY VARCHAR2(250),
    CONSTRAINT fk_inf_user FOREIGN KEY (USERID)
        REFERENCES USERBASE(USERID),
    CONSTRAINT fk_inf_rule FOREIGN KEY (RULENUM)
        REFERENCES COMMUNITYRULES(RULENUM)
);

INSERT INTO INFRACTIONS VALUES (1, 101, 1, SYSDATE, 'Warning');
INSERT INTO INFRACTIONS VALUES (2, 102, 2, SYSDATE, '3 Day Ban');
INSERT INTO INFRACTIONS VALUES (3, 103, 3, SYSDATE, 'Warning');
INSERT INTO INFRACTIONS VALUES (4, 104, 4, SYSDATE, '7 Day Ban');
INSERT INTO INFRACTIONS VALUES (5, 105, 5, SYSDATE, 'Account Review');
INSERT INTO INFRACTIONS VALUES (6, 106, 6, SYSDATE, 'Permanent Ban');
INSERT INTO INFRACTIONS VALUES (7, 107, 7, SYSDATE, 'Warning');
INSERT INTO INFRACTIONS VALUES (8, 108, 8, SYSDATE, '3 Day Ban');
INSERT INTO INFRACTIONS VALUES (9, 109, 9, SYSDATE, 'Warning');
INSERT INTO INFRACTIONS VALUES (10, 110, 10, SYSDATE, 'Warning');




-- Question 9: USERSUPPORT


CREATE TABLE USERSUPPORT (
    TICKETID NUMBER PRIMARY KEY,
    EMAIL VARCHAR2(250),
    ISSUE VARCHAR2(250),
    DATESUBMITTED DATE,
    DATEUPDATED DATE,
    STATUS VARCHAR2(250)
);

INSERT INTO USERSUPPORT VALUES (1, 'user1@email.com', 'Cannot login', SYSDATE, SYSDATE, 'NEW');
INSERT INTO USERSUPPORT VALUES (2, 'user2@email.com', 'Game crash', SYSDATE, SYSDATE, 'IN PROGRESS');
INSERT INTO USERSUPPORT VALUES (3, 'user3@email.com', 'Refund request', SYSDATE, SYSDATE, 'CLOSED');
INSERT INTO USERSUPPORT VALUES (4, 'user4@email.com', 'Bug report', SYSDATE, SYSDATE, 'NEW');
INSERT INTO USERSUPPORT VALUES (5, 'user5@email.com', 'Password reset', SYSDATE, SYSDATE, 'IN PROGRESS');
INSERT INTO USERSUPPORT VALUES (6, 'user6@email.com', 'Account hacked', SYSDATE, SYSDATE, 'CLOSED');
INSERT INTO USERSUPPORT VALUES (7, 'user7@email.com', 'Payment issue', SYSDATE, SYSDATE, 'NEW');
INSERT INTO USERSUPPORT VALUES (8, 'user8@email.com', 'Feature request', SYSDATE, SYSDATE, 'IN PROGRESS');
INSERT INTO USERSUPPORT VALUES (9, 'user9@email.com', 'Install problem', SYSDATE, SYSDATE, 'CLOSED');
INSERT INTO USERSUPPORT VALUES (10, 'user10@email.com', 'Report user', SYSDATE, SYSDATE, 'NEW');



-- Question 10: Views


CREATE VIEW UNIQUEQUESTIONS AS
SELECT DISTINCT QUESTION
FROM SECURITYQUESTION;

CREATE VIEW ACTIVETICKETS AS
SELECT TICKETID, EMAIL, ISSUE, DATEUPDATED
FROM USERSUPPORT
WHERE STATUS IN ('NEW', 'IN PROGRESS')
ORDER BY DATEUPDATED;